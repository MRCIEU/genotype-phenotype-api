2 Boxes:

- Swarm Manager (runs Redis + API + frontend)
- Swarm Worker (runs gwas_upload_pipeline)

1. Initialize Docker Swarm on Swarm Manager

        docker swarm init --advertise-addr <private-ip-address>

    This will return a command like `docker swarm join --token SWMTKN-1-xxxx SWARM_MANAGER_IP:2377`. Copy it

    You will need to open up the port for other boxes to join:
    No
	
    Stateless Source IP Protocol Source Port Range Destination Port Range Type and Code Allows
    0.0.0.0/0 TCP All 2377 TCP traffic for ports: 2377 

    Also, you will need to open the port on the OS
    sudo firewall-cmd --permanent --add-port=2377/tcp
    sudo firewall-cmd --permanent --add-port=6379/tcp
    sudo firewall-cmd --permanent --zone=trusted --add-source=10.0.0.0/16
    sudo firewall-cmd --reload


2. Join Swarm Worker to the Swarm

    Run to leave a docker swarm:
        sudo docker swarm leave

    Run the join command on Swarm Worker:

        docker swarm join --token SWMTKN-1-xxxx MACHINE_A_IP:2377

    Check membership on Swarm Manager:

        docker node ls

    You should see:

    Swarm Manager → Leader
    Swarm Worker → Worker


3. Create a Swarm-wide overlay network

    Run on Swarm Manager:

        docker network create --driver=overlay --attachable gpmap_network

    (gpmap_network is defined in the stack yml files, name is important to keep the same)

4. Create node labels

sudo docker node update --label-add type=special-box <node-id>

5. Take down the whole stack

docker stack rm gpmap

4. Deploy

    sudo docker stack deploy -c docker-swarm.yml gpmap


Component	            Machine

Redis	                A
API	                    A
frontend	            A
gwas_upload_pipeline	B