#!/bin/bash
set -e

curl -X POST "http://localhost:8000/v1/internal/clear-cache/all"
echo "All redis caches cleared"

curl "http://localhost:8000/v1/info/gpmap_metadata"
curl "http://localhost:8000/v1/search/options"

# Array of study IDs to set cache for
study_ids=(
    3744 4055 2608 4757 4758 1491 1625 1638 1987 2007 2011 3743 4053 2397 2477 2585 2595 2596 28 1482 1485 1624 1626
    2006 3759 2326 2408 2573 2581 2597 2613 2622 2623 2818 3000 3358 4409 4770 1486 1487 1622 1623 1628 1634 1636 1644
    1985 1995 3693 4092 2591 2605 2611 2869 2892 2939 3142 3149 3219 3448 4184 4215 4320 4761 4773 917 919 921 1632
    1989 2382 3242 3277 4764 4767 925 934 936 1643 1648 1997 2001 3771 2583 2603 2607 2614 3431 3464 4257 4423 30 114
    928 1490 1633 1650 2012 2478 2523 2586 2589 2600 2609 2620 2790 3282 3497 4363 4766 4776 4777 937 1488 1492 1631
    1637 1639 1980 1993 3717 3763 2379 2467 2479 2527 3162 3265 3374 4452 4532 21 100 932 938 1481 1627 1641 1982 1990
    3748 3757 4050 2584 2601 2606 3217 4286 4365 4472 4503 4748 4759 131 924 1640 2008 3814 3962 2577 2647 2904 3143 3613
    4141 4400 4765 24 920 1501 1629 1649 1992 1996 2002 3699 3992 2587 2599 2621 2625 3084 3133 3169 3342 3424 3584 930
    1294 1984 1998 3775 2343 2617 2618 2906 3228 3599 4771 923 1480 1630 1642 2383 2384 2588 2624 3499 3516 4353 4772 168
    1483 1652 1983 1991 1994 2590 3090 3241 4241 4763 931 935 1988 3680 3709 3827 3990 2340 2582 2598 2612 2644 3395 4233
    132 918 933 939 1285 1653 1986 2009 2604 2615 3587 4143 4303 4760 4778 922 926 927 1284 1647 1981 2017
)

for study_id in "${study_ids[@]}"; do
    echo "Setting associations cache for: $study_id"
    curl "http://localhost:8000/v1/traits/$study_id?include_associations=true" > /dev/null
done
